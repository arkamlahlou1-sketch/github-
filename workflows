# .github/workflows/daily_update.yml
name: Daily AliExpress Deals Update # Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„

on:
  schedule:
    # Ø³ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„ ÙƒÙ„ ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 00:00 Ø¨Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ø§Ù„Ù…Ù†Ø³Ù‚ (UTC)
    - cron: '0 0 * * *' 
  workflow_dispatch: # ÙŠØªÙŠØ­ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø¹Ù…Ù„

jobs:
  update-products:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ¦Ø© Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # 2. ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install python-aliexpress-api # ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø©
          
      # 3. ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø¨ÙˆØª ÙˆØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø±Ø§Ø±
      - name: Run product fetcher script
        run: python product_fetcher.py
        env:
          APP_KEY: ${{ secrets.ALIEXPRESS_APP_KEY }}
          SECRET_KEY: ${{ secrets.ALIEXPRESS_SECRET_KEY }}
          TRACKING_ID: ${{ secrets.ALIEXPRESS_TRACKING_ID }} # ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø±!

      # 4. Ø§Ø±ØªÙƒØ§Ø¨ ÙˆØ¯ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ğŸ¤– Daily product update from AliExpress'
          files: products.json # Ø¯ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ± ÙÙŠ Ù…Ù„Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙ‚Ø·
